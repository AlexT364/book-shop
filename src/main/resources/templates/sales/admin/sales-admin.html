<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" th:href="@{/css/style.css}">
<link rel="stylesheet" th:href="@{/css/sales/sales.css}">
<link rel="icon" th:href="@{/images/icons/logo-tiny.png}">
<title>Sales admin</title>
</head>
<body>
	<div id="page-container">
		<header th:replace="~{fragments/navigation}"></header>
		<section class="discounts-section">
			<div class="no-discounts-container" th:if="${discounts.isEmpty()}">
				<h1>There are no sales right now :(</h1>
			</div>
			<div class="new-sale-ref-container" sec:authorize="hasRole('ROLE_ADMIN')">
				<a th:href="@{/admin/sales/add}">Add new Sale</a>
			</div>
			<div th:unless="${discounts.isEmpty()}" class="container">
				<h2 class="section-title">Current Sales</h2>
				<div class="discounts-grid">
					<div class="discount-card" th:each="discount : ${discounts}">
						<p>
							<span style="color: red; font-weight: bold;" th:if="${discount.expired}" th:text="'EXPIRED'"></span>						
							<span style="color: green; font-weight: bold;" th:if="${discount.active}" th:text="'ENABLED'"></span>
							<span style="color: red; font-weight: bold;" th:unless="${discount.active}" th:text="'DISABLED'"></span>
						</p>
						<h3 class="discount-name" th:text="${discount.name}">Discount Name</h3>
						<p class="discount-description" th:text="${discount.description}">Description of the discount</p>
						<p class="discount-dates">
							<span th:text="${#temporals.format(discount.startDate, 'dd MMM yyyy')}">start date</span> &mdash; <span
								th:text="${#temporals.format(discount.endDate, 'dd MMM yyyy')}">End Date</span>
						</p>
						<div class="discount-actions">
							<form th:unless="${discount.active}" 
							th:method="DELETE"
							th:action="@{/admin/sales/{discountId} (discountId=${discount.id})}">
								<button class="btn" onclick="return confirmDelete();">Delete sale</button>
							</form>
							<form th:if="${discount.active}">
								<button class="btn btn-clr disabled">Disable first</button>
							</form>
							<form th:if="${discount.active}" 
							th:method="PATCH"
							th:action="@{/admin/sales/{discountId}/deactivate (discountId=${discount.id})}">
								<button class="btn">Disable</button>
							</form>
							<form th:unless="${discount.active}" 
							th:method="PATCH"
							th:action="@{/admin/sales/{discountId}/activate (discountId=${discount.id})}">
								<button class="btn">Enable</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>
		
		<div class="pagination" th:unless="${discounts.getTotalPages() <= 1}">

			<!-- 		First-Page -->
			<a th:if="${discounts.hasPrevious()}" 
				th:href="@{/admin/sales(pageNumber=0)}"
				th:text="'First'" class="btn-link"></a>
			<span th:unless="${discounts.hasPrevious()}" class="btn-link btn-link-clr disabled" th:text="'First'"></span>

			<!-- 		Previous-Page -->
			<a th:if="${discounts.hasPrevious()}"
				th:href="@{/admin/sales(pageNumber=${discounts.number-1})}" th:text="'<'"
				class="btn-link"></a>
			<span th:unless="${discounts.hasPrevious()}" class="btn-link btn-link-clr disabled" th:text="'<'"></span> <span
				th:if="${discounts.number > 2}">...</span>

			<!-- Current page and neighboring pages -->
			<a
				th:each="page : ${#numbers.sequence(discounts.number > 2 ? discounts.number - 2 : 1, discounts.number + 2 < discounts.getTotalPages() ? discounts.number + 2 : discounts.getTotalPages())}"
				th:text="${page}" class="btn-link" th:classappend="${page}-1 == ${discounts.number} ? 'current-page'"
				th:href="@{/admin/sales(pageNumber=${page-1})}"> </a>


			<span th:if="${discounts.number + 2 < discounts.getTotalPages()}">...</span>

			<!-- 		Next-Page -->
			<a th:if="${discounts.hasNext()}"
				th:href="@{/admin/sales(pageNumber=${discounts.number+1})}" th:text="'>'"
				class="btn-link"></a>
			<span th:unless="${discounts.hasNext()}" class="btn-link btn-link-clr disabled" th:text="'>'"></span>

			<!-- 		Last-Page -->
			<a th:if="${discounts.hasNext()}"
				th:href="@{/admin/sales(pageNumber=${discounts.getTotalPages()-1})}" th:text="'Last'"
				class="btn-link"></a>
			<span th:unless="${discounts.hasNext()}" class="btn-link btn-link-clr disabled" th:text="'Last'"></span>

		</div>
	</div>
	<footer th:replace="~{fragments/footer}"> Footer </footer>
	<script>
		function confirmDelete() {
			return confirm("Are you sure you want to delete this sale?");
		}
	</script>
</body>
</html>